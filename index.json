[{"content":"æ¼”ç¤ºæ¡ˆä¾‹æ¶æ„å›¾ ä¸­é—´ä»¶æœåŠ¡æ„å»º æ ¹æ®SpringCloudAlibabaä¸SpringCloudçš„å¯¹åº”å…³ç³»,æœ¬æ¬¡æ¡ˆä¾‹å®ç°é‡‡ç”¨ä¸­é—´ä»¶/æ¡†æ¶ç‰ˆæœ¬å¦‚ä¸‹\nSpring Boot: 2.6.13 Spring Cloud: 2021.0.5 Spring Cloud Alibaba: 2021.0.5.0 Nacos: 2.2.0 Seata: 1.6.1 Mysql: 8.1.0 Nacosæ„å»º ä»è¿™é‡Œä¸‹è½½Nacosé¢„ç¼–è¯‘åŒ…,nacosé…ç½®æ•°æ®æˆ‘ä»¬é‡‡ç”¨æŒä¹…åŒ–åˆ°æ•°æ®åº“çš„æ–¹å¼\né¦–å…ˆå‡†å¤‡nacosçš„æ•°æ®åº“å®ä¾‹:\nversion: \u0026#39;3.1\u0026#39; services: nacos: image: mysql:8.1.0 restart: always container_name: mysql_nacos environment: MYSQL_ROOT_PASSWORD: 5566 command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci --explicit_defaults_for_timestamp=true --lower_case_table_names=1 ports: - 3306:3306 volumes: - ./config/data/mysql:/var/lib/mysql ç„¶åä¿®æ”¹NacosåŒ…ä¸­çš„schemeå¯¼å…¥åˆ°è¯¥æ•°æ®åº“å®ä¾‹ä¸­\nä¿®æ”¹confç›®å½•ä¸‹çš„application.propertiesæ–‡ä»¶,ä¸»è¦ä¿®æ”¹ä»¥ä¸‹å‡ é¡¹(å•æœºæ¨¡å¼,é›†ç¾¤å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¿®æ”¹):\n#*************** Config Module Related Configurations ***************# ### If use MySQL as datasource: spring.datasource.platform=mysql ### Count of DB: db.num=1 ### Connect URL of DB: db.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8\u0026amp;connectTimeout=1000\u0026amp;socketTimeout=3000\u0026amp;autoReconnect=true\u0026amp;useUnicode=true\u0026amp;useSSL=false\u0026amp;serverTimezone=UTC db.user.0=root db.password.0=5566 å¯åŠ¨nacos:\n/Users/fanzhengxiang/data/service/nacos2.2.0/bin/startup.sh -m standalone\nSeataæ„å»º ä»è¿™é‡Œä¸‹è½½seataçš„é¢„ç¼–è¯‘åŒ…,æœ¬æ¬¡å®éªŒseataæ•°æ®åŒæ ·æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­,å‡†å¤‡ä¸€ä¸ªæ•°æ®åº“å®ä¾‹\nversion: \u0026#39;3.1\u0026#39; services: seata_db: image: mysql:8.1.0 restart: always container_name: mysql_seata environment: MYSQL_ROOT_PASSWORD: 5566 command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci --explicit_defaults_for_timestamp=true --lower_case_table_names=1 ports: - 3307:3306 volumes: - ./config/data/mysql:/var/lib/mysql å°†mysqlçš„å»ºè¡¨æ•°æ®å¯¼å…¥åˆ°seataçš„æ•°æ®åº“å®ä¾‹ä¸­\nä¿®æ”¹seataçš„å¯åŠ¨é…ç½®æ–‡ä»¶conf/application.yml,ä¸»è¦ä¿®æ”¹configé¡¹,registryé¡¹ç›®,storeé¡¹ç›®,ä»¥ä¸‹æ˜¯å®ä¾‹\næ³¨æ„:ç”±äºmysqlçš„ç‰ˆæœ¬ä¸º8,æ‰€ä»¥é©±åŠ¨è¿æ¥ä¸ºcom.mysql.cj.jdbc.Driver,å¹¶ä¸”éœ€è¦ä¸‹è½½mysql8çš„javaé©±åŠ¨åˆ°seataçš„libæŠ¥ä¸‹\n# Copyright 1999-2019 Seata.io Group. # # Licensed under the Apache License, Version 2.0 (the \u0026#34;License\u0026#34;); # you may not use this file except in compliance with the License. # You may obtain a copy of the License at # # http://www.apache.org/licenses/LICENSE-2.0 # # Unless required by applicable law or agreed to in writing, software # distributed under the License is distributed on an \u0026#34;AS IS\u0026#34; BASIS, # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. # See the License for the specific language governing permissions and # limitations under the License. server: port: 7091 spring: application: name: seata-server logging: config: classpath:logback-spring.xml file: path: ${user.home}/logs/seata # extend: # logstash-appender: # destination: 127.0.0.1:4560 # kafka-appender: # bootstrap-servers: 127.0.0.1:9092 # topic: logback_to_logstash console: user: username: seata password: seata seata: config: # support: nacos ã€ consul ã€ apollo ã€ zk ã€ etcd3 type: nacos nacos: server-addr: 127.0.0.1:8848 namespace: group: SEATA_GROUP username: password: context-path: ##if use MSE Nacos with auth, mutex with username/password attribute #access-key: #secret-key: data-id: seataServer.properties registry: # support: nacos ã€ eureka ã€ redis ã€ zk ã€ consul ã€ etcd3 ã€ sofa type: nacos nacos: application: seata-server server-addr: 127.0.0.1:8848 group: SEATA_GROUP namespace: cluster: default username: password: context-path: ##if use MSE Nacos with auth, mutex with username/password attribute #access-key: #secret-key: store: db: datasource: druid db-type: mysql ## è¿™é‡Œæ³¨æ„mysql8çš„é©±åŠ¨è¿æ¥ä¸ºcom.mysql.cj.jdbc.Driver driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://127.0.0.1:3307/seata?rewriteBatchedStatements=true user: root password: 5566 min-conn: 10 max-conn: 100 global-table: global_table branch-table: branch_table lock-table: lock_table distributed-lock-table: distributed_lock query-limit: 1000 max-wait: 5000 # server: # service-port: 8091 #If not configured, the default is \u0026#39;${server.port} + 1000\u0026#39; security: secretKey: SeataSecretKey0c382ef121d778043159209298fd40bf3850a017 tokenValidityInMilliseconds: 1800000 ignore: urls: /,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/api/v1/auth/login å¯åŠ¨seata: nohup sh bin/seata-server.sh -p 18091 -n 1 \u0026amp;\nnacos: æ³¨å†Œä¿¡æ¯\nseataæ§åˆ¶å°\nä»£ç å‡†å¤‡ æºç åœ¨è¿™é‡ŒæŸ¥çœ‹\nå‡†å¤‡ä¸‰ä¸ªå¾®æœåŠ¡æ¨¡å—çš„æ•°æ®åº“å®ä¾‹\nversion: \u0026#39;3.1\u0026#39; services: seata_order: image: mysql:8.1.0 restart: always container_name: seata_order environment: MYSQL_ROOT_PASSWORD: 5566 command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci --explicit_defaults_for_timestamp=true --lower_case_table_names=1 ports: - 3308:3306 volumes: - ./order/config/data/mysql:/var/lib/mysql seata_inventory: image: mysql:8.1.0 restart: always container_name: seata_inventory environment: MYSQL_ROOT_PASSWORD: 5566 command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci --explicit_defaults_for_timestamp=true --lower_case_table_names=1 ports: - 3309:3306 volumes: - ./inventory/config/data/mysql:/var/lib/mysql seata_account: image: mysql:8.1.0 restart: always container_name: seata_account environment: MYSQL_ROOT_PASSWORD: 5566 command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci --explicit_defaults_for_timestamp=true --lower_case_table_names=1 ports: - 3310:3306 volumes: - ./account/config/data/mysql:/var/lib/mysql é¡¹ç›®ä¾èµ–:\n\u0026lt;properties\u0026gt; \u0026lt;maven.compiler.target\u0026gt;8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;maven.compiler.source\u0026gt;8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;spring.boot.version\u0026gt;2.6.13\u0026lt;/spring.boot.version\u0026gt; \u0026lt;spring.cloud.version\u0026gt;2021.0.5\u0026lt;/spring.cloud.version\u0026gt; \u0026lt;spring.cloud.alibaba.version\u0026gt;2021.0.5.0\u0026lt;/spring.cloud.alibaba.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring.boot.version}\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring.cloud.version}\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-alibaba-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring.cloud.alibaba.version}\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.18.28\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; ä»¥è®¢å•æœåŠ¡ä¸ºä¾‹\né¡¹ç›®é…ç½®æ–‡ä»¶application.yml\nserver: port: 8081 # ç«¯å£ spring: application: name: order-service datasource: url: jdbc:mysql://127.0.0.1:3308/seata_order?useSSL=false\u0026amp;useUnicode=true\u0026amp;characterEncoding=UTF-8 driver-class-name: com.mysql.cj.jdbc.Driver username: root password: 5566 cloud: nacos: discovery: server-addr: 127.0.0.1:8848 seata: application-id: ${spring.application.name} tx-service-group: ${spring.application.name}-group service: vgroup-mapping: order-service-group: default registry: type: nacos nacos: cluster: default server-addr: localhost namespace: å…¶ä¸­è´¦æˆ·æœåŠ¡å’Œåº“å­˜æœåŠ¡çš„Feignæ¥å£å¦‚ä¸‹\nimport com.aires.feign.dto.AccountReduceBalanceDTO; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestBody; /** * `account-service` æœåŠ¡çš„ Feign å®¢æˆ·ç«¯ */ @FeignClient(name = \u0026#34;account-service\u0026#34;) public interface AccountServiceFeignClient { @PostMapping(\u0026#34;/account/reduce-balance\u0026#34;) void reduceBalance(@RequestBody AccountReduceBalanceDTO accountReduceBalanceDTO); } import com.aires.feign.dto.ProductReduceStockDTO; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestBody; /** * `product-service` æœåŠ¡çš„ Feign å®¢æˆ·ç«¯ */ @FeignClient(name = \u0026#34;product-service\u0026#34;) public interface ProductServiceFeignClient { @PostMapping(\u0026#34;/product/reduce-stock\u0026#34;) void reduceStock(@RequestBody ProductReduceStockDTO productReduceStockDTO); } ä¸‹å•çš„æ ¸å¿ƒä¸šåŠ¡ä»£ç \n@Service public class OrderServiceImpl implements OrderService { private Logger logger = LoggerFactory.getLogger(getClass()); @Resource private OrderDao orderDao; @Resource private AccountServiceFeignClient accountService; @Resource private ProductServiceFeignClient productService; @Override @GlobalTransactional public Integer createOrder(Long userId, Long productId, Integer price) { Integer amount = 1; // è´­ä¹°æ•°é‡ï¼Œæš‚æ—¶è®¾ç½®ä¸º 1ã€‚ logger.info(\u0026#34;[createOrder] å½“å‰ XID: {}\u0026#34;, RootContext.getXID()); // æ‰£å‡åº“å­˜ productService.reduceStock(new ProductReduceStockDTO().setProductId(productId).setAmount(amount)); // æ‰£å‡ä½™é¢ accountService.reduceBalance(new AccountReduceBalanceDTO().setUserId(userId).setPrice(price)); // ä¿å­˜è®¢å• OrderDO order = new OrderDO().setUserId(userId).setProductId(productId).setPayAmount(amount * price); orderDao.saveOrder(order); logger.info(\u0026#34;[createOrder] ä¿å­˜è®¢å•: {}\u0026#34;, order.getId()); // è¿”å›è®¢å•ç¼–å· return order.getId(); } } åˆ†å¸ƒå¼äº‹åŠ¡æ¼”ç¤º // TODO\n","permalink":"https://www.atomicbot.cloud/posts/tech/seata_at%E6%A8%A1%E5%BC%8F%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%AE%9E%E8%B7%B5/","summary":"æ¼”ç¤ºæ¡ˆä¾‹æ¶æ„å›¾ ä¸­é—´ä»¶æœåŠ¡æ„å»º æ ¹æ®SpringCloudAlibabaä¸SpringCloudçš„å¯¹åº”å…³ç³»,æœ¬æ¬¡æ¡ˆä¾‹å®ç°é‡‡ç”¨ä¸­é—´ä»¶/æ¡†æ¶ç‰ˆæœ¬å¦‚ä¸‹ Spring Boot: 2.6.13 Spring Cloud: 2021.0.5 Spring Cloud Alibaba: 2021.0.5.0 Nacos: 2.2.0 Seata: 1.6.1 Mysql: 8.1.0 Nacosæ„å»º ä»è¿™é‡Œä¸‹è½½Nacosé¢„ç¼–è¯‘åŒ…,nacosé…ç½®æ•°æ®æˆ‘ä»¬é‡‡ç”¨æŒä¹…åŒ–åˆ°æ•°æ®åº“çš„æ–¹å¼ é¦–å…ˆå‡†å¤‡nacos","title":"Spring Cloud Feign \u0026\u0026 Seata Atæ¨¡å¼åˆ†å¸ƒå¼äº‹åŠ¡å®è·µ"},{"content":"Spring Cloud Feign åœ¨å¼‚æ­¥æ¥å£æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼ é€’è¯·æ±‚å¤´Token ä¸šåŠ¡æµç¨‹ ç”¨æˆ·å‘èµ·è¯·æ±‚å,åœ¨AæœåŠ¡ä¸­æ‰§è¡Œä¸šåŠ¡é€»è¾‘,æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨å…¶ä»–å¾®æœåŠ¡Bè¿›è¡Œæµç¨‹å®¡æ‰¹,ç®€å•æ–¹å¼æ˜¯åœ¨AæœåŠ¡ä¸­æ‰€æœ‰é€»è¾‘(1,2,3)é‡‡ç”¨åŒæ­¥é€»è¾‘æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­,ä½†æ˜¯å¦‚æœè°ƒç”¨BæœåŠ¡çš„è¿‡ç¨‹ä¸­,å¤„ç†é€»è¾‘å¾ˆå¤æ‚,ä¼šå¯¼è‡´AæœåŠ¡çš„è¯·æ±‚ä¸€ç›´é˜»å¡,ç”¨æˆ·ä½“éªŒå¾ˆä¸å¥½\nä¼˜åŒ–åçš„é€»è¾‘ä¸ºå°†ç¬¬2æ­¥,è°ƒæ•´ä¸ºå¼‚æ­¥é€»è¾‘,å¼‚æ­¥è°ƒç”¨æœåŠ¡B,å¯ä»¥ä½¿AæœåŠ¡å¿«é€Ÿå®Œæˆé€»è¾‘å¤„ç†,ç›¸åº”ç”¨æˆ·,BæœåŠ¡åœ¨æµç¨‹å‘èµ·æˆåŠŸä¹‹å,å†å›è°ƒAæœåŠ¡,å›å†™æµç¨‹å‘èµ·çš„ç»“æœ(æµç¨‹å‘èµ·æˆåŠŸæˆ–è€…æµç¨‹å‘èµ·å¤±è´¥çš„åŸå› ),æ­¤æ—¶å°±å¼•ç”³å‡ºä¸€ä¸ªé—®é¢˜: åœ¨å¼‚æ­¥è°ƒç”¨æ—¶,feignæ¥å£çš„è¯·æ±‚ä¼šä¸¢å¤±æ‰è¯·æ±‚å¤´ä¸­çš„Token,å¯¼è‡´åœ¨è°ƒç”¨æœåŠ¡Bæ—¶å‡ºç°401\nè§£å†³æ–¹æ¡ˆ ç½‘ä¸Šå¤§å¤šæ•°çš„è§£å†³åŠæ³•éƒ½æ˜¯æŠ„æ¥æŠ„å»ä½¿ç”¨æ‹¦æˆªå™¨æ–¹å¼å®ç°,ä¸æ¨è,æˆ‘è¿™é‡Œé‡‡ç”¨çš„æ˜¯Feignå®˜æ–¹çš„è§£å†³æ–¹æ¡ˆ,Feign Builder\næ‰‹åŠ¨åˆ›å»ºFeign Client\nå®é™…æ“ä½œ å¾®æœåŠ¡Bç°æœ‰çš„Feignæ¥å£å¦‚ä¸‹:\n@FeignClient( name = \u0026#34;eip-bpm-runtime\u0026#34;, url = \u0026#34;${eip-bpm-runtime:}\u0026#34;, fallbackFactory = FlowApiFallback.class ) public interface FlowApi { @RequestMapping( value = {\u0026#34;/flow/instance/v1/start\u0026#34;}, method = {RequestMethod.POST}, produces = {\u0026#34;application/json; charset=utf-8\u0026#34;} ) ObjectNode start(@RequestBody JSONObject var1) throws Exception; } ç°åœ¨éœ€è¦åœ¨AæœåŠ¡ä¸­æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªFlowApiçš„å®ä¾‹å‘èµ·è°ƒç”¨\né¦–å…ˆåœ¨AæœåŠ¡ä¸­åˆ›å»ºä¸€ä¸ªé…ç½®ç±»\nimport com.aliyun.openservices.shade.com.alibaba.fastjson.support.spring.FastJsonJsonView; import com.fasterxml.jackson.databind.ObjectMapper; import com.hotent.api.FlowApi; import feign.Client; import feign.Feign; import org.apache.http.HttpHeaders; import org.springframework.beans.factory.ObjectFactory; import org.springframework.boot.autoconfigure.http.HttpMessageConverters; import org.springframework.cloud.openfeign.support.SpringDecoder; import org.springframework.cloud.openfeign.support.SpringEncoder; import org.springframework.cloud.openfeign.support.SpringMvcContract; import org.springframework.http.converter.HttpMessageConverter; import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter; import org.springframework.stereotype.Component; import javax.annotation.Resource; /** * BPM å¼‚æ­¥feignè¯·æ±‚å¤´è®¾ç½® * * @author kiki * @date 2022/1/13 14:25 * @since 0.0.1 */ @Component public class BpmFlowApiConfig { @Resource private Client client; /** * æ¥å£è¯·æ±‚path */ private String url; public void setUrl(String url) { this.url = url; } public FlowApi flowApiClient(String accessToken){ HttpMessageConverter jsonConverter = new MappingJackson2HttpMessageConverter(new ObjectMapper()); ObjectFactory\u0026lt;HttpMessageConverters\u0026gt; converter = () -\u0026gt; new HttpMessageConverters(jsonConverter); return Feign.builder().client(client) .encoder(new SpringEncoder(converter)) .decoder(new SpringDecoder(converter)) .contract(new SpringMvcContract()) .requestInterceptor(template -\u0026gt; template.header(org.springframework.http.HttpHeaders.AUTHORIZATION, accessToken)) .requestInterceptor(template -\u0026gt; template.header(HttpHeaders.CONTENT_TYPE, FastJsonJsonView.DEFAULT_CONTENT_TYPE)) .target(FlowApi.class, url); } } ç„¶ååœ¨éœ€è¦å‘èµ·å¯¹BæœåŠ¡è°ƒç”¨çš„åœ°æ–¹æ³¨å…¥è¯¥é…ç½®ç±»,å¹¶æ‰‹åŠ¨æ„å»ºFeignå®¢æˆ·ç«¯å‘èµ·è°ƒç”¨\n/** * desc * * @author kiki * @date 2022/1/13 11:37 * @since 0.0.1 */ @Service @Slf4j public class IAsyncServiceImpl implements IAsyncService { /** * ç›®æ ‡å¾®æœåŠ¡çš„æœåŠ¡åç§° * */ @Value(\u0026#34;${bpm.url:http://eip-bpm-runtime/}\u0026#34;) private String flowApiUrl; @Resource private BpmFlowApiConfig bpmFlowApiConfig; /** * å¼‚æ­¥ä¸Šä¼ å‘ç¥¨å¹¶å‘èµ·å®¡æ‰¹ * * @param paymentAddEo è¯·æ±‚å‚æ•° * @param header ä¸Šæ¸¸è¯·æ±‚çš„Token */ @Async @Override public void uploadInvoicesAndStartBpmProcess(PaymentBillAddReqDto paymentAddEo, String header) { // TODO AæœåŠ¡çš„è‡ªèº«ä¸šåŠ¡é€»è¾‘... startNewBpmProcess(paymentAddEo, fileIdList, header); // TODO AæœåŠ¡çš„è‡ªèº«åç»­ä¸šåŠ¡é€»è¾‘... } private void startNewBpmProcess(PaymentBillAddReqDto paymentAddEo, List\u0026lt;String\u0026gt; fileIdList, String header) { try { // ...çœç•¥ä¸šåŠ¡é€»è¾‘ log.info(\u0026#34;{}å‘èµ·bpmç”³è¯·æµç¨‹å‚æ•°ï¼š{}\u0026#34;, paymentBillDesc, paramStr); // è¿™é‡Œæ˜¯å‘èµ·è°ƒç”¨é…ç½®çš„å…³é”® // 1.è®¾ç½®è°ƒç”¨æœåŠ¡çš„æœåŠ¡å // 2.æ‰‹åŠ¨ä¸ºFeign Clientè®¾ç½®header(token) bpmFlowApiConfig.setUrl(flowApiUrl); start = bpmFlowApiConfig.flowApiClient(header).start(JSON.parseObject(paramStr)); ObjectMapper objectMapper = new ObjectMapper(); String resultStr = objectMapper.writeValueAsString(start); log.info(\u0026#34;{}å‘èµ·BPMå®¡æ‰¹è¯·æ±‚ç»“æœï¼š{}\u0026#34;, paymentBillDesc, resultStr); // ...çœç•¥ä¸šåŠ¡é€»è¾‘ bpmProcessService.add(reqDto); } catch (Exception e) { log.error(\u0026#34;{}å¤±è´¥ï¼Œbpmè¿”å›ä¿¡æ¯{}ï¼Œä¿å­˜çš„æµç¨‹ä¿¡æ¯{}ï¼Œé”™è¯¯ä¿¡æ¯ï¼š{}\u0026#34;, paymentBillDesc, JSON.toJSONString(start), JSONObject.toJSONString(paymentAddEo, SerializerFeature.PrettyFormat), e); throw new BizException(String.format(\u0026#34;%så‘èµ·BPMå®¡æ‰¹å¤±è´¥ï¼\u0026#34;, e.getMessage())); } } } å…¶ä¸­,AæœåŠ¡åœ¨è¯·æ±‚å‘èµ·æ—¶,ä¼ é€’çš„Tokenéœ€è¦åœ¨AæœåŠ¡å‘èµ·è°ƒç”¨å‰äº‹å…ˆè·å–\nServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes(); HttpServletRequest request = requestAttributes.getRequest(); String accessToken = request.getHeader(\u0026#34;Access-Token\u0026#34;); ","permalink":"https://www.atomicbot.cloud/posts/tech/springcloudfeign%E5%9C%A8%E5%BC%82%E6%AD%A5%E6%8E%A5%E5%8F%A3%E6%89%A7%E8%A1%8C%E7%9A%84%E8%BF%87%E7%A8%8B%E4%B8%AD%E4%BC%A0%E9%80%92%E8%AF%B7%E6%B1%82%E5%A4%B4token/","summary":"Spring Cloud Feign åœ¨å¼‚æ­¥æ¥å£æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼ é€’è¯·æ±‚å¤´Token ä¸šåŠ¡æµç¨‹ ç”¨æˆ·å‘èµ·è¯·æ±‚å,åœ¨AæœåŠ¡ä¸­æ‰§è¡Œä¸šåŠ¡é€»è¾‘,æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨å…¶ä»–å¾®æœåŠ¡Bè¿›è¡Œæµç¨‹å®¡æ‰¹,ç®€å•æ–¹å¼æ˜¯åœ¨AæœåŠ¡ä¸­æ‰€æœ‰é€»è¾‘(1,2,3)é‡‡ç”¨åŒæ­¥é€»è¾‘æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­,ä½†æ˜¯å¦‚æœè°ƒç”¨BæœåŠ¡çš„è¿‡ç¨‹ä¸­,å¤„ç†é€»è¾‘å¾ˆå¤æ‚,ä¼šå¯¼è‡´AæœåŠ¡çš„è¯·æ±‚ä¸€ç›´é˜»å¡","title":"Spring Cloud Feignåœ¨å¼‚æ­¥æ¥å£æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼ é€’è¯·æ±‚å¤´Token"},{"content":" ğŸ”–ğŸ”– 211éç§‘ç­ç¨‹åºå‘˜,è‡ªå­¦ç¼–ç¨‹æ··å£é¥­åƒ,åæ ‡æˆéƒ½,åœ¨æŸä¸­å¤§å‹é£Ÿå“å…¬å¸ä»»Javaå¼€å‘å·¥ç¨‹å¸ˆä¸€æšã€‚\nä¸»è¦æŠ€æœ¯æ ˆæ¶‰çŒæœ‰ä»¥ä¸‹: ğŸ’¥ Javaæ ¸å¿ƒ ğŸ’¥ Spring Boot Spring Cloudç”Ÿæ€ ğŸ’¥ Springç”Ÿæ€å¸¸ç”¨ä¸”æˆç†Ÿçš„ä¸­é—´ä»¶ ğŸš€ Vue2+Vue3 (å­¦ä¹ ä¸­,æš‚æ—¶è¿˜å·®ç‚¹ç«å€™) âš¡ï¸ Mysqlæ•°æ®åº“ä¸LinuxæœåŠ¡å™¨ ğŸš€ CI/CD,æŒç»­é›†æˆ ğŸ’¥ å¾®æœåŠ¡é›†ç¾¤+k8så®¹å™¨ç”Ÿæ€ ğŸ™ˆ Flutter App å¼€å‘\u0026hellip;(å­¦ä¹ ä¸­) \u0026hellip;\u0026hellip;\u0026hellip;\u0026hellip;\u0026hellip;\u0026hellip; ç®€å•å…ˆå†™è¿™äº›,ä¸ªäººé¡¹ç›®åç»­å®Œå–„ ğŸ‰ ğŸ‰ ğŸ‰\n","permalink":"https://www.atomicbot.cloud/about/","summary":"ğŸ”–ğŸ”– 211éç§‘ç­ç¨‹åºå‘˜,è‡ªå­¦ç¼–ç¨‹æ··å£é¥­åƒ,åæ ‡æˆéƒ½,åœ¨æŸä¸­å¤§å‹é£Ÿå“å…¬å¸ä»»Javaå¼€å‘å·¥ç¨‹å¸ˆä¸€æšã€‚ ä¸»è¦æŠ€æœ¯æ ˆæ¶‰çŒæœ‰ä»¥ä¸‹: ğŸ’¥ Javaæ ¸å¿ƒ ğŸ’¥ Spring Boot Spring Cloudç”Ÿæ€ ğŸ’¥ Springç”Ÿæ€å¸¸ç”¨ä¸”æˆç†Ÿçš„ä¸­é—´ä»¶ ğŸš€ Vue2+Vue3 (å­¦ä¹ ä¸­,æš‚æ—¶è¿˜å·®ç‚¹ç«å€™) âš¡ï¸ Mysqlæ•°æ®åº“ä¸LinuxæœåŠ¡å™¨ ğŸš€ CI/CD,æŒç»­é›†æˆ","title":"æˆ‘çš„ä¸€äº›ä¿¡æ¯ğŸ‰ğŸ‰ğŸ‰ "}]